/*
 * Tangobox, part of the TangoCMS Project
 * --- jQuery plugin based upon FancyBox by Janis Skarnelis, and ideas taken from jQuery
 * lightbox by Leandro Vieira Pinho.
 *
 * Changes we basically do to Fancybox is remove MSIE6 support, default support for certain
 * selectors, improve the markup/css and major code cleanups. It also handles loading images
 * that the URL does not contain the file extension in.
 *
 * @author Alex Cartwright
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.html GNU/GPL 2
 */
jQuery(document).ready(function(){jQuery("a[rel=modal]").tangobox();jQuery("a[rel=modalImage]").tangobox()});(function(a){a.fn.tangobox=function(h){var h=a.extend({imageScale:true,zoomOpacity:true,zoomSpeedIn:500,zoomSpeedOut:"slow",frameWidth:560,frameHeight:340,overlayShow:true,overlayOpacity:0.7,overlayColor:"#444",showCloseButton:true,callbackOnStart:null,callbackOnShow:null,callbackOnClose:null},h);var o=this;var g;var c=[],b=0,k=false,i=/\.(jpe?g|gif|png)($|\?)?$/i;var m,n;function j(){if(!k){g=this;if(a.isFunction(h.callbackOnStart)){h.callbackOnStart()}if(!a("#tbOverlay").length){var q='<div id="tbOverlay"></div> 								<div id="tbWrap"> 									<div id="tbOuter"> 										<div id="tbInner"> 											<div id="tbContent"></div> 											<div id="tbNav"> 												<a href="" id="tbNavPrev"></a> 												<a href="" id="tbNavNext"></a> 											</div> 											<div id="tbTitle"></div> 										</div> 									</div> 								</div>';a(q).appendTo("body")}m=a("#tbOuter");n=a("#tbContent");if(h.overlayShow){a("#tbOverlay").css({backgroundColor:h.overlayColor,opacity:h.overlayOpacity}).fadeIn(200)}else{a("tbOverlay").hide()}var r=o.length;for(var p=0;p<r;p++){c[p]={elem:o[p],href:a(o[p]).attr("href"),title:a(o[p]).attr("title"),rel:a(o[p]).attr("rel")};if(c[p].href==a(g).attr("href")){b=p}}f()}return false}function f(){a("#tbNavPrev, #tbNavNext, #tbClose, #tbTitle").hide();var q=c[b];if(m.is(":visible")===false){m.css("top","120px").show()}m.addClass("inProgress");if(q.href.match(/#/)){m.addClass("typeInline");d(a(window.location.hash).html(),h.frameWidth,h.frameHeight)}else{if(g.rel=="modalImage"||q.href.match(i)){m.addClass("typeImage");if(n.is(":visible")){n.fadeOut()}var p=new Image;p.onload=function(){var u=p.width,s=p.height;var t=a(window).width()-120,r=a(window).height()-120;if(h.imageScale&&(u>t||s>r)){var v=Math.min(Math.min(t,u)/u,Math.min(r,s)/s);u=Math.round(v*u);s=Math.round(v*s)}d('<img alt="" id="tbImage" src="'+p.src+'" height="'+s+'" width="'+u+'">',u,s)};p.src=q.href}else{m.addClass("typeAjax");a.get(q.href,function(w){var s={},v=q.elem.search.replace("?","").split("&"),r;var u=v.length;for(var t=0;t<u;t++){r=v[t].split("=");s[r[0]]=r[1]}d('<div id="tbInline">'+w+"</div>",(s.width||h.frameWidth),(s.height||h.frameHeight))})}}return b}function d(t,r,v){k=true;r=parseInt(r);v=parseInt(v);var w=a(window).height(),s=a(window).scrollTop();var p=m.css("paddingTop").replace(/[^\d\.]/g,"")*2;var x=(v+p)/2;var u=(w/2-x)+s+"px";if(m.is(":visible")&&r==m.width()&&v==m.height()){var q={width:r}}else{var q={height:v+"px",width:r+"px"}}if(u!==m.css("top")){q.top=u;if(m.is(":visible")==false&&s!==0&&q.top.replace(/[^\d\.]/g,"")>s){m.css("top",s+"px")}}m.show();n.fadeOut("normal",function(){n.empty();m.animate(q,h.zoomSpeedIn,function(){n.html(a(t));n.fadeIn("normal",e)})})}function e(){var q=[];if((c.length-1)>b){q[0]=c[b+1]}if(b>0){q[1]=c[b-1]}for(var p in q){var r=q[p];if(r.rel=="modalImage"||r.href.match(i)){objNext=new Image();objNext.src=r.href}}if(c[b].rel=="modalImage"||c[b].href.match(i)){if(b!==0){a("#tbNavPrev").show().unbind().click(function(){--b;f();return false})}if(b!==(c.length-1)){a("#tbNavNext").show().unbind().click(function(){++b;f();return false})}}a(document).bind("keyup",l);n.bind("click",l);a("#tbOuter").removeClass("inProgress");if(a.isFunction(h.callbackOnShow)){h.callbackOnShow(c[b])}k=false}function l(p){if(p.keyCode===27||p.button===0){a(document).unbind();n.unbind().empty();m.css({height:"250px",width:"250px",top:"0"}).hide().removeAttr("class");a("#tbOverlay").fadeOut(h.zoomSpeedOut);if(a.isFunction(h.callbackOnClose)){h.callbackOnClose(c[b])}}}return this.unbind("click").bind("click",j)}})(jQuery);