$(document).ready(function(){var a=[],f=[];$("textarea.richtext").each(function(b){var c=this;shebang=/^#\!([A-Z0-9_\-]+)/i.exec($(this).val());if(shebang==null)a[b]=tcmEditor.defaultFormat.toLowerCase();else{$(this).val(jQuery.trim($(this).val().replace(/^#\![A-Z0-9_\-]+/i,"")));a[b]=shebang[1].toLowerCase()}if(a[b]=="html"&&typeof CKEDITOR!=undefined)f[b]=CKEDITOR.replace(c);$(this).parents("form").submit(function(){var e=a.shift();e=="html"&&typeof CKEDITOR!=undefined&&f.shift().destroy();var d=
$(c).val();if(e=="html"&&/^<p>#\!([A-Z0-9_\-]+)<\/p>/i.test(d))$(c).val(d.replace(/<p>#\!([A-Z0-9_\-]+)<\/p>/i,"#!$1"));else/^#\!([A-Z0-9_\-]+)/i.test(d)==false&&$(c).val("#!"+e+"\n"+d);return true})})});
